<!DOCTYPE html>
<!-- saved from url=(0025)http://127.0.0.1:8000/app -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    <meta name="viewport" content="width=device-width">
    <meta name="theme-color" content="#ffffff">
    <title>App | Task Aura</title>
    <meta name="application-name" content="Task Aura">
    <meta name="author" content="https://github.com/theitdaily">
    <meta name="description" content="Free Note-Taking and To-Do App">
    <meta property="og:title" content="Task Aura">
    <meta property="og:description" content="Free Note-Taking and To-Do App">

    <!-- App Head: Start -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://theitdaily.github.io/task-aura/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="https://theitdaily.github.io/task-aura/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="https://theitdaily.github.io/task-aura/favicon-16x16.png" />

    <link rel="manifest" href="manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('https://theitdaily.github.io/task-aura/sw.js')
                    .then(reg => console.log('Service Worker registered', reg))
                    .catch(error => console.log('Service Worker registration error', error));
            });
        }
    </script>
    <!-- App Head: End -->

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Bootstrap CSS -->
    <link href="./resources/bootstrap.min.css" rel="stylesheet">
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Bootstrap Icons -->
    <link rel="stylesheet" href="./resources/bootstrap-icons.css">

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            padding-bottom: 88px;
        }

        /* –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —Å –¥–Ω—è–º–∏ –Ω–µ–¥–µ–ª–∏ */
        .week-days {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .day {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .day:hover {
            background-color: #e8e8e8;
        }
        .day.active {
            font-weight: bold;
            color: #007bff;
            background-color: #f2e4fb85;
        }

        /* –ë–ª–æ–∫ –∑–∞–¥–∞—á */
        .tasks {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            padding-bottom: 70px; /* —á—Ç–æ–±—ã –Ω–µ –∑–∞–≥–æ—Ä–∞–∂–∏–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É */
        }

        /* –°—Ç–∏–ª—å –∑–∞–¥–∞—á */
        .task {
            display: flex;
            align-items: center;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 12px;
            margin-bottom: 8px;
            background-color: #f8fcff;
        }

        .task-left {
            flex: 0 0 auto;
            margin-right: 6px;
            font-size: 36px;
        }

        .task-center {
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
        }

        .task-time {
            font-size: 12px;
        }

        .task-title {
            font-size: 16px;
            font-weight: bold;
            margin-top: -2px;
        }

        .task.expired {
            background-color: #ffe7e7;
            color: #b00000;
        }

        .task.task.done .task-title {
            text-decoration: line-through;
        }

        .task.task.done {
            background-color: #c1faeb;
            color: #5d5d5d;
        }

        .task-right {
            flex: 0 0 auto;
            margin: 0 6px;
            cursor: pointer;
            font-size: 35px;
        }

        /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            background-color: #ffffff;
            padding: 10px 0;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
        }
        .nav-button {
            flex: 1;
            text-align: center;
            padding: 10px 0;
            font-weight: bold;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: color 0.2s;
        }
        .nav-button.active {
            color: #007bff;
        }

        /* –ò–∫–æ–Ω–∫–∏ –≤ –∑–∞–¥–∞—á–∞—Ö –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .icon {
            margin-left: 8px;
            font-size: 1.2em;
        }

        /* –ö–Ω–æ–ø–∫–∞ + —Å–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞ */
        .add-note-btn {
            position: fixed;
            bottom: 105px; /* —á—É—Ç—å –≤—ã—à–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #007bff;
            color: #fff;
            border: none;
            font-size: 2em;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .add-note-btn:hover {
            background-color: #0056b3;
        }
    </style>

    <style>
        .nav-top {
            background-color: #f7f6ff;
            margin-bottom: 15px;
            border-radius: 16px;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.1);
        }
        .nav-top.disabled {
            pointer-events: none;
        }
        .nav-top.disabled div, .nav-top.disabled button {
            color: #888888 !important;
        }

        /* –û–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–∞–ø–æ–∫ –∏ –∑–∞–º–µ—Ç–æ–∫ */
        #notesContainer, #routineContainer, #tasksContainer, #profileContainer {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: opacity 0.5s ease, max-height 0.5s ease;
        }

        /* –ê–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        #notesContainer.show, #routineContainer.show, #tasksContainer.show, #profileContainer.show {
            opacity: 1;
            max-height: fit-content; /* –∏–ª–∏ –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π –º–∞–∫—Å–∏–º—É–º, —á—Ç–æ–±—ã –ø–ª–∞–≤–Ω–æ —Ä–∞—Å–∫—Ä—ã—Ç—å */
        }

        #profileContainer {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            grid-gap: 10px;
            flex-direction: column;
            align-items: center;
        }

        #profileContainer button {
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            width: 100%;
            margin: 0;
        }

        #deleteAllBtn, #resetToFactoryBtn {
            background-color: #ff1010;
            color: #000;
        }

        #languageSelect {
            width: auto;
            display: block;
        }

        /* –°—Ç–∏–ª—å –ø–∞–ø–∫–∏ */
        .folder, .no-folder {
            border-radius: 4px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* –í–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏ */
        .folder .folder {
            margin: 10px 0;
            border: 1px solid #e6e6e6;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–ø–∫–∏ */
        .folder-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ */
        .folder-name {
            font-weight: bold;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }

        /* –ó–∞–º–µ—Ç–∫–∞ –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ */
        .note {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            border-bottom: 1px solid #ddd;
            border-right: 1px solid #ddd;
            background-color: #fafafa;
            margin-top: 4px;
            border-radius: 3px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-top: 1px solid #e7e7ec;
        }

        .note:hover {
            background-color: #f0f0f0;
        }

        .sub-notes {
            padding: 0 0 5px 7px;
            margin-bottom: 4px;
        }

        .sub-notes .full-note {
            margin-right: 3px;
        }

        .full-note {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–º–µ—Ç–∫–∏ */
        .note-title {
            flex: 1;
            padding: 6px 4px 6px 8px;
            font-size: 1em;
        }

        /* –ò–∫–æ–Ω–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è */
        .icon {
            font-size: 1.2em;
            margin-left: 8px;
            cursor: pointer;
            color: #555;
            transition: color 0.2s;
        }

        .icon:hover {
            color: #000;
        }
    </style>

    <style>
        #nextWeek, #prevWeek {
            border: 0;
            font-weight: 700;
            font-family: emoji;
            background-color: #0000;
        }

        .create-folder-btn {
            border-radius: 9px;
            border: 1px #efefef solid;
            padding: 6px 13px;
            background-color: #fafafa;
            margin: 10px auto 30px;
            color: #000;
        }

        .modal {
            align-content: center;
        }
    </style>

        <meta name="version" content="1.0.18.3">
</head>
<body>
        <!-- –í–∫–ª–∞–¥–∫–∞ Routine (–∞–∫—Ç–∏–≤–Ω–∞—è) -->
    <div class="nav-top">
        <div class="container my-3" style="max-width: 750px;">
            <!-- –ù–∞–¥–ø–∏—Å—å —Å –ø–æ–ª–Ω–æ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç–æ–π -->
            <!-- –ù–µ–¥–µ–ª—è -->
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <button id="prevWeek" class="m-1">&lt;&lt; </button>
                <div id="fullDateDisplay" class="text-center" style="font-weight: bold;">Sunday, January 18, 2026</div>
                <button id="nextWeek" class="m-1"> &gt;&gt;</button>
            </div>
            <div class="d-flex justify-content-around" id="weekDays">
                <div class="text-center day active" data-day="2026-01-18"><div>Sun</div><div>18</div></div>
                <div class="text-center day" data-day="2026-01-19"><div>Mon</div><div>19</div></div>
                <div class="text-center day" data-day="2026-01-20"><div>Tue</div><div>20</div></div>
                <div class="text-center day" data-day="2026-01-21"><div>Wed</div><div>21</div></div>
                <div class="text-center day" data-day="2026-01-22"><div>Thu</div><div>22</div></div>
                <div class="text-center day" data-day="2026-01-23"><div>Fri</div><div>23</div></div>
                <div class="text-center day" data-day="2026-01-24"><div>Sat</div><div>24</div></div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –∑–∞–¥–∞—á -->
    <div class="container flex-fill show" id="routineContainer"></div>

    <!-- –ë–ª–æ–∫ –∑–∞–¥–∞—á –±–µ–∑ —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏ -->
    <div class="container flex-fill" id="tasksContainer"></div>

    <!-- –ë–ª–æ–∫ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏ -->
    <div class="container" style="display: grid;" id="notesContainer">
        <div class="container flex-fill" id="notesContainerContent"></div>
        <button class="bi-plus-square icon create-folder-btn" data-bs-toggle="modal" data-bs-target="#formCreateFolder" title="Create folder"> Create folder</button>
    </div>

    <!-- –ë–ª–æ–∫ —Å –∑–∞–º–µ—Ç–∫–∞–º–∏ -->
    <div class="container" id="profileContainer">
        <button id="deleteAllBtn" class="bi bi-trash icon" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal" title="Delete all data">
            Delete all data        </button>
        <button id="resetToFactoryBtn" class="bi bi-trash icon" data-bs-toggle="modal" data-bs-target="#resetToFactoryBtnConfirmModal" title="Reset to factory settings">
            Reset to factory settings        </button>
        <select id="languageSelect" class="form-select">
            <option value="en" selected="">English</option>
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
        </select>
        <span>Version: 1.0.18.3</span>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ + —Å–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞ -->
    <button class="btn btn-primary add-note-btn" title="Add a note/task" data-bs-toggle="modal" data-bs-target="#formNoteModal">+</button>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="modal fade" id="notificationModal" tabindex="-1" aria-labelledby="notificationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="notificationModalLabel">Notification</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="notificationModalBody">
                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteConfirmModalLabel">Confirmation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete all data?                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="modal fade" id="resetToFactoryBtnConfirmModal" tabindex="-1" aria-labelledby="resetToFactoryBtnConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resetToFactoryBtnConfirmModalLabel">Confirmation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete all data?                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmResetBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Bootstrap –¥–ª—è –≤–≤–æ–¥–∞ —á–∏—Å–ª–∞ -->
    <div class="modal fade" id="goalInputModal" tabindex="-1" aria-labelledby="goalInputModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="goalInputModalLabel">Enter a number for the goal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="number" id="task" style="display: none">
                    <input type="number" class="form-control" id="goalNumberInput" placeholder="Enter a number">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="modalConfirmBtn">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏ -->
    <div class="modal fade" id="formNoteModal" tabindex="-1" aria-labelledby="formNoteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="formNoteModalLabel">Add a note</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="formNoteForm">
                        <input type="text" name="id" id="formNoteID" class="d-none">
                        <div class="input-group mb-3">
                            <input type="text" autocomplete="task-name" class="form-control" placeholder="Name" id="formNoteTitle" aria-label="Name">
                            <span class="input-group-text"></span>
                            <input type="text" autocomplete="task-icon" class="form-control" placeholder="Icon (optional)" id="formNoteIcon" aria-label="Icon (optional)">
                        </div>
                        <div class="mb-3">
                            <label for="formNoteDescription" class="form-label">Content</label>
                            <textarea class="form-control" id="formNoteDescription" rows="4" required=""></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="formNoteFolder" class="form-label">Folder</label>
                            <select class="form-select" id="formNoteFolder" aria-label="Select a folder"><option value="">Without a folder</option></select>
                        </div>
                        <div class="mb-3">
                            <label for="formNoteParentNote" class="form-label">Parent note</label>
                            <select class="form-select" id="formNoteParentNote" aria-label="Select a note"><option value="">Without a note</option></select>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="isTaskSwitch">
                            <label class="form-check-label" for="isTaskSwitch">Task</label>
                        </div>
                        <!-- –ù–∞—á–∞–ª–æ –∑–∞–¥–∞—á–∏ -->
                        <div class="mb-3" id="taskDateStartContainer" style="display: none;">
                            <label for="taskDateStart" class="form-label">Start of the task</label>
                            <input type="date" class="form-control" id="taskDateStart">
                        </div>
                        <!-- –ö–æ–Ω–µ—Ü –∑–∞–¥–∞—á–∏ -->
                        <div class="mb-3" id="taskDateEndContainer" style="display: none;">
                            <label for="taskDateEnd" class="form-label">End of task</label>
                            <input type="date" class="form-control" id="taskDateEnd">
                        </div>

                        <!-- –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ -->
                        <div class="mb-3" id="taskRepeatContainer" style="display: none;">
                            <label for="taskRepeat" class="form-label">Repetition</label>
                            <select class="form-select" id="taskRepeat">
                                <option value="null">No repetitions</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>

                            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
                            <div id="repeatDailyContainer" style="display: none; margin: 10px 0;">
                                <label for="dailyInterval">Interval (days):</label>
                                <input type="number" id="dailyInterval" min="1" max="10000" value="1">
                            </div>
                            <div id="repeatWeeklyContainer" style="display: none; margin: 10px 0;">
                                <label>Days of the week:</label><br>
                                <label><input type="checkbox" value="1" class="weekly-day-checkbox">Monday</label>
                                <label><input type="checkbox" value="2" class="weekly-day-checkbox">Tuesday</label>
                                <label><input type="checkbox" value="3" class="weekly-day-checkbox">Wednesday</label>
                                <label><input type="checkbox" value="4" class="weekly-day-checkbox">Thursday</label>
                                <label><input type="checkbox" value="5" class="weekly-day-checkbox">Friday</label>
                                <label><input type="checkbox" value="6" class="weekly-day-checkbox">Saturday</label>
                                <label><input type="checkbox" value="0" class="weekly-day-checkbox">Sunday</label><br><br>
                                <label for="weeklyInterval">Interval (weeks):</label>
                                <input type="number" id="weeklyInterval" min="1" max="52" value="1">
                            </div>
                            <div id="repeatMonthlyContainer" style="display: none; margin: 10px 0;">
                                <label>Dates of the month:</label><br>
                                <select id="monthDays" multiple="" size="6">
                                    <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
                                <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option></select><br><br>
                                <label for="monthlyInterval">Interval (months):</label>
                                <input type="number" id="monthlyInterval" min="1" max="12" value="1">
                            </div>
                        </div>

                        <!-- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
                        <div class="mb-3" id="taskTimeContainer" style="display: none;">
                            <label for="taskTimeType" class="form-label">Execution time</label>
                            <select class="form-select" id="taskTimeType">
                                <option value="null">At any time</option>
                                <option value="exact">Exact time (e.g. 09:00)</option>
                                <option value="period">Period (from 10:30 to 10:45)</option>
                            </select>

                            <!-- –¢–æ—á–Ω–æ–µ –≤—Ä–µ–º—è -->
                            <input type="time" class="form-control mt-2" id="taskTimeStart">
                            <input type="time" class="form-control mt-2" id="taskTimeEnd">
                        </div>

                        <!-- –¶–µ–ª—å (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ/–≤—Ä–µ–º—è) -->
                        <div class="mb-3" id="taskGoalContainer" style="display: none;">
                            <label for="taskGoalType" class="form-label">Goal</label>
                            <select class="form-select" id="taskGoalType">
                                <option value="null">Complete the task</option>
                                <option value="count">Quantity</option>
                                <option value="time">Lead time</option>
                            </select>

                            <!-- –î–ª—è "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π" -->
                            <div id="taskGoalCount" style="display: none;">
                                <label for="taskRepeatCount" class="form-label mt-2">Quantity</label>
                                <input type="number" class="form-control" id="taskRepeatCount">
                            </div>

                            <!-- –î–ª—è "–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è" -->
                            <div id="taskTimeGoal" style="display: none;">
                                <label for="taskGoalMinutes" class="form-label mt-2">Minutes</label>
                                <input type="number" class="form-control" id="taskGoalMinutes">

                                <label for="taskGoalSeconds" class="form-label mt-2">Seconds</label>
                                <input type="number" class="form-control" id="taskGoalSeconds">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="formNoteCancelBtn" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="formNoteSaveBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞–ø–∫–∏ -->
    <div class="modal fade" id="formCreateFolder" tabindex="-1" aria-labelledby="formCreateFolderLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="formCreateFolderLabel">Create folder</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createFolderForm">
                        <div class="mb-3">
                            <label for="folderName" class="form-label">Folder name</label>
                            <input type="text" autocomplete="folder-name" class="form-control" id="folderName" required="">
                        </div>
                        <div class="mb-3">
                            <label for="parentFolderSelect" class="form-label">Parent folder</label>
                            <select class="form-select" id="parentFolderSelect"><option value="">Without a folder</option></select>
                        </div>
                        <button type="submit" class="btn btn-primary">Create</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Bootstrap -->
    <div class="modal fade" id="noteModal" tabindex="-1" aria-labelledby="noteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="noteModalLabel"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="noteDescription">
                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ -->
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar fixed-bottom bottom-nav">
        <button class="nav-button active" data-target="routineContainer">
            <i class="bi bi-house-door-fill"></i>
            <span>Routine</span>
        </button>
        <button class="nav-button" data-target="tasksContainer">
            <i class="bi bi-list-task"></i>
            <span>Tasks</span>
        </button>
        <button class="nav-button" data-target="notesContainer">
            <i class="bi bi-journal-text"></i>
            <span>Notes</span>
        </button>
        <button class="nav-button" data-target="profileContainer">
            <i class="bi bi-person-circle"></i>
            <span>Profile</span>
        </button>
    </nav>
        
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Bootstrap JS –∏ Popper -->
    <script src="./resources/bootstrap.bundle.min.js"></script>

    <script>
        // =============================== //
        // === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ === //
        // =============================== //

        Date.prototype.toStringWithoutTime = function() {
            const year = this.getFullYear();
            const month = (this.getMonth() + 1).toString().padStart(2, '0');
            const day = this.getDate().toString().padStart(2, '0');

            return `${year}-${month}-${day}`;
        };

        Date.prototype.getWeekNumber = function () {
            const tempDate = new Date(this.getFullYear(), this.getMonth(), this.getDate());
            const firstDayOfYear = new Date(tempDate.getFullYear(), 0, 0);
            const daysOffset = firstDayOfYear.getDay();
            firstDayOfYear.setDate(firstDayOfYear.getDate() - daysOffset);
            const diff = Math.floor((tempDate - firstDayOfYear) / (24 * 60 * 60 * 1000));
            return Math.ceil((diff + 1) / 7);
        };

        Date.prototype.getWeekStart = function () {
            const day = this.getDay(); // 0 (Sunday) - 6 (Saturday)
            const start = new Date(this);
            start.setDate(this.getDate() - day); // —Å–¥–≤–∏–≥ –Ω–∞ –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏
            return start;
        };

        // ======================== //
        // === –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ === //
        // ======================== //

        // –ú–∞—Å—Å–∏–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        let data = {
            notes: {
                1: {
                    id: 1,
                    title: 'Start working with notes',
                    description: 'A simple app for taking notes and tasks.',
                    folder: 1
                },
                2: {
                    id: 2,
                    title: 'Data clearing',
                    description: 'In the profile, you can click \'clear data\' to delete all notes, folders, tasks.',
                    folder: 1
                },
                3: {
                    id: 3,
                    title: 'Note outside folder',
                    description: 'Notes can be stored without a folder.',
                    folder: null
                },
                4: {
                    id: 4,
                    title: 'Multiple attachments',
                    description: 'Notes can be stored in a complex folder hierarchy.',
                    folder: 4
                },
                5: {
                    id: 5,
                    title: 'Note in child folder',
                    description: 'Notes can be stored in a complex folder hierarchy.',
                    folder: 3
                },
                6: {
                    id: 6,
                    title: 'Complete Task Aura training',
                    description: 'It is necessary to study everything from the section \'Working in Task Aura\'.',
                    folder: 1,
                    task: 1
                },
                7: {
                    id: 7,
                    title: 'Check email',
                    icon: 'üìß',
                    description: 'Checking email for new messages.',
                    folder: null,
                    task: 2
                },
                8: {
                    id: 8,
                    title: 'Check mailbox',
                    description: 'Checking the mailbox at the address —É–ª.–°—Ç—Ä–∞–Ω–Ω–∞—è, –¥.494.',
                    folder: null,
                    task: 3
                },
                9: {
                    id: 9,
                    title: 'Take out the boxes to the garage',
                    description: 'A clean apartment is a good apartment.',
                    folder: null,
                    task: 4
                },
                10: {
                    id: 10,
                    title: 'Fulfill the dream',
                    description: 'Write down all tasks, habits and notes in one app!',
                    folder: null,
                    task: 5
                },
                11: {
                    id: 11,
                    title: 'Go for a walk',
                    description: 'Sometimes you need to go for a walk',
                    folder: null,
                    task: 6
                },
                12: {
                    id: 12,
                    title: 'Play a new game',
                    description: 'Sometimes you need to rest',
                    folder: null,
                    task: 7
                },
                13: {
                    id: 13,
                    title: 'Pet the cat',
                    icon: 'üêà',
                    description: 'At least 5 times a day, you should do this!',
                    folder: null,
                    task: 8
                },
                14: {
                    id: 14,
                    title: 'Rest',
                    icon: '‚õ∫Ô∏è',
                    task: 9
                },
                15: {
                    id: 15,
                    title: 'Child note',
                    parent: 1,
                    folder: 1
                },
                16: {
                    id: 16,
                    title: 'Grandchild note #1',
                    parent: 15,
                    folder: 1
                },
                17: {
                    id: 17,
                    title: 'Grandchild note #2',
                    parent: 15,
                    folder: 1
                },
                18: {
                    id: 18,
                    title: 'Grandchild note #3',
                    parent: 15,
                    folder: 1
                },
                19: {
                    id: 19,
                    title: 'Another child note',
                    parent: 1,
                    folder: 1
                }
            }, // –∫–ª—é—á: ID, –∑–Ω–∞—á–µ–Ω–∏–µ: –¥–∞–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏
            tasks: {
                1: {
                    id: 1,
                    note: 6,
                    regularity: null,
                    dateStart: '2026-01-01',
                    dateEnd: '2026-01-01'
                },
                2: {
                    id: 2,
                    note: 7,
                    regularity: {
                        type: 'daily',          // —Ç–∏–ø —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏: daily, weekly, monthly, custom
                        interval: 1,            // –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –∫–∞–∂–¥—ã–µ 2 –¥–Ω—è –∏ —Ç.–¥.
                        daysOfWeek: null,       // –¥–ª—è weekly: –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ (1 ‚Äî –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 7 ‚Äî –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
                        daysOfMonth: null,       // –¥–ª—è monthly: —á–∏—Å–ª–∞ –º–µ—Å—è—Ü–∞
                        customFrequency: null   // –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
                    },
                    dateStart: '2025-01-01',
                    timeStart: '09:00',
                    timeEnd: '10:00',
                    completion: {
                        2025: {
                            53: [null, null, true, true, null, null, null],
                        },
                        2026: {
                            1: [null, null, null, null, null, null, true],
                            2: [true, true, null, null, null, null, null],
                        }
                    }
                },
                3: {
                    id: 3,
                    note: 8,
                    regularity: {
                        type: 'daily',          // —Ç–∏–ø —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏: daily, weekly, monthly, custom
                        interval: 3,            // –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –∫–∞–∂–¥—ã–µ 2 –¥–Ω—è –∏ —Ç.–¥.
                        daysOfWeek: null,       // –¥–ª—è weekly: –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ (1 ‚Äî –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 7 ‚Äî –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
                        daysOfMonth: null,       // –¥–ª—è monthly: —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞
                        customFrequency: null   // –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
                    },
                    dateStart: '2026-01-01',
                    timeStart: '11:00',
                },
                4: {
                    id: 4,
                    note: 9,
                    regularity: {
                        type: 'weekly',          // —Ç–∏–ø —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏: daily, weekly, monthly, custom
                        interval: 1,            // –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –∫–∞–∂–¥—ã–µ 2 –¥–Ω—è –∏ —Ç.–¥.
                        daysOfWeek: null,       // –¥–ª—è weekly: –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ (1 ‚Äî –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 7 ‚Äî –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
                        daysOfMonth: null,       // –¥–ª—è monthly: —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞
                        customFrequency: null   // –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
                    },
                    dateStart: '2026-01-01'
                },
                5: {
                    id: 5,
                    note: 10,
                    regularity: null,
                    dateStart: '2026-01-01',
                    dateEnd: '2026-12-31'
                },
                6: {
                    id: 6,
                    note: 11,
                    regularity: null,
                    dateStart: '2026-01-01',
                    dateEnd: '2026-01-31',
                    timeStart: '09:00',
                    timeEnd: '11:00',
                    completion: true,
                    completedAt: '2026-02-04',
                },
                8: {
                    id: 8,
                    note: 13,
                    regularity: {
                        type: 'daily',          // —Ç–∏–ø —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏: daily, weekly, monthly, custom
                        interval: 1,            // –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –∫–∞–∂–¥—ã–µ 2 –¥–Ω—è –∏ —Ç.–¥.
                        daysOfWeek: null,       // –¥–ª—è weekly: –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ (1 ‚Äî –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 7 ‚Äî –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
                        daysOfMonth: null,       // –¥–ª—è monthly: —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞
                        customFrequency: null   // –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
                    },
                    goal: {
                        type: 'count',
                        count: 5,
                    },
                    dateStart: '2026-01-01',
                    completion: {
                        2026: {
                            1: [null, null, null, null, 8, 5, 5],
                            2: [3, 0, 14, null, null, null, null],
                        }
                    }
                },
                9: {
                    id: 9,
                    note: 14,
                    regularity: {
                        type: 'daily',          // —Ç–∏–ø —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏: daily, weekly, monthly, custom
                        interval: 1,            // –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –∫–∞–∂–¥—ã–µ 2 –¥–Ω—è –∏ —Ç.–¥.
                        daysOfWeek: null,       // –¥–ª—è weekly: –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ (1 ‚Äî –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 7 ‚Äî –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
                        daysOfMonth: null,       // –¥–ª—è monthly: —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞
                        customFrequency: null   // –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
                    },
                    goal: {
                        type: 'time',
                        count: 3600,
                    },
                    dateStart: '2026-01-01',
                    timeStart: '12:00',
                    completion: {
                        2026: {
                            1: [null, null, null, null, 1000, 3600, 1800],
                            2: [1799, 1500, 180, null, null, null, null],
                        }
                    }
                }
            }, // –∫–ª—é—á: ID, –∑–Ω–∞—á–µ–Ω–∏–µ: –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
            folders: {
                1: {
                    id: 1,
                    name: 'Work in Task Aura'
                },
                2: {
                    id: 2,
                    name: 'Main folder'
                },
                3: {
                    id: 3,
                    name: 'Child folder'
                },
                4: {
                    id: 4,
                    name: 'Grandchild folder'
                }
            }, // –∫–ª—é—á: ID, –∑–Ω–∞—á–µ–Ω–∏–µ: –¥–∞–Ω–Ω—ã–µ –ø–∞–ø–∫–∏
            structure: [
                {id: 1, children: []},
                {id: 2, children: [{id: 3, children: [{id: 4, children: []}]}]}
            ] // –∏–µ—Ä–∞—Ä—Ö–∏—è –ø–∞–ø–æ–∫ –≤ –∑–∞–º–µ—Ç–∫–∞—Ö (–ø–æ ID)
        };
        let selectedDate = (new Date(new Date().toDateString()));
        let currentWeekStart = null; // –Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –∏–ª–∏ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
        function load() {
            const json = localStorage.getItem('appData');
            if (json) {
                data = JSON.parse(json);
            }
            afterLoadData();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
        function save() {
            localStorage.setItem('appData', JSON.stringify(data));
        }

        // –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function clearData() {
            // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
            data = {
                notes: {},
                tasks: {},
                folders: {},
                structure: []
            };
            afterLoadData();
            save();
            showNotification('Data deleted!');
            updateWeek(selectedDate);
            refreshNotes();
            updateFolderListInForm();
            updateCreateFolderOptions();
        }

        function resetData() {
            localStorage.clear();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–ª–∏ –æ–±–Ω—É–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        function afterLoadData() {
            if (data.task_max_id == null) {
                data.task_max_id = 0;
                if (Object.keys(data.tasks).length > 0) {
                    data.task_max_id = Math.max(...Object.keys(data.tasks).map(id => parseInt(id)));
                }
            }
            if (data.note_max_id == null) {
                data.note_max_id = 0;
                if (Object.keys(data.notes).length > 0) {
                    data.note_max_id = Math.max(...Object.keys(data.notes).map(id => parseInt(id)));
                }
            }
            if (data.folder_max_id == null) {
                data.folder_max_id = 0;
                if (Object.keys(data.folders).length > 0) {
                    data.folder_max_id = Math.max(...Object.keys(data.folders).map(id => parseInt(id)));
                }
            }
        }

        // =================================== //
        // === –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ === //
        // =================================== //

        function isTaskDue(task, date) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–¥–∞—á–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ (–µ—Å—Ç—å dateStart)
            if (!task.dateStart) {
                console.error('–£ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –∑–∞–¥–∞—á–∏ ‚Ññ' + task.id + ' –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –¥–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞.');
                return false;
            }

            const dateStart = (new Date(new Date(task.dateStart).toDateString()));
            if (date < dateStart) {
                return false;
            }

            const { type, interval, daysOfWeek, daysOfMonth } = task.regularity;

            switch (type) {
                case 'daily':
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–Ω–∏—Ü—ã –≤ –¥–Ω—è—Ö –º–µ–∂–¥—É –ø–æ—Å–ª–µ–¥–Ω–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∏ —Å–µ–≥–æ–¥–Ω—è
                    const diffDays = Math.floor((date - dateStart) / (1000 * 60 * 60 * 24));
                    return diffDays % interval === 0;

                case 'weekly':
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª
                    if (daysOfWeek) {
                        if (!daysOfWeek.includes(date.getDay())) return false;
                        if (interval) {
                            const weekDiff = Math.floor((date - dateStart) / (1000 * 60 * 60 * 24 * 7));
                            return weekDiff % interval === 0;
                        }
                    }
                    else if (interval) {
                        const weekDiff = Math.floor((date - dateStart) / (1000 * 60 * 60 * 24));
                        return weekDiff % (interval * 7) === 0;
                    }
                    return true;

                case 'monthly':
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω—è –º–µ—Å—è—Ü–∞
                    if (!daysOfMonth.includes(date.getDate())) return false;
                    if (interval) {
                        const monthsDiff = (date.getFullYear() - dateStart.getFullYear()) * 12 + (date.getMonth() - dateStart.getMonth());
                        return monthsDiff % interval === 0;
                    }
                    return true;

                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ —Å–ª—É—á–∞–∏ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
                default:
                    return false;
            }
        }

        function getRegularityTasksFromDate(date) {
            const completedTasks = [];
            const notCompletedTasks = [];

            // –û–±—Ö–æ–¥ –≤—Å–µ—Ö –∑–∞–¥–∞—á
            for (const taskId in data.tasks) {
                const task = data.tasks[taskId];

                // –ï—Å–ª–∏ —É –∑–∞–¥–∞—á–∏ –Ω–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                if (!task.regularity) {
                    continue;
                }

                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –¥–æ–ª–∂–Ω–∞ –ª–∏ –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è
                const isDue = isTaskDue(task, date);
                if (isDue) {
                    // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏
                    if (IsTaskCompleted(task)) {
                        completedTasks.push(task);
                    } else {
                        notCompletedTasks.push(task);
                    }
                }
            }

            return [...notCompletedTasks, ...completedTasks];
        }

        function getOnetimeTasksFromDate(date) {
            const completedTasks = [];
            const notCompletedTasks = [];

            for (const taskId in data.tasks) {
                const task = data.tasks[taskId];

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å
                if (!task.regularity) {
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç
                    if (date < (new Date(new Date(task.dateStart).toDateString())) || (IsTaskCompleted(task) && IsTaskExpired(task, date))) {
                        continue;
                    }

                    // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏
                    if (IsTaskCompleted(task)) {
                        completedTasks.push(task);
                    } else {
                        notCompletedTasks.push(task);
                    }
                }
            }

            // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–ø–∏—Å–∫–∏: —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ, –ø–æ—Ç–æ–º –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
            return [...notCompletedTasks, ...completedTasks];
        }

        function GetTaskGoalPercent(task) {
            if (task.goal != null) {
                if (task.goal.type === 'count') {
                    return GetTaskCompletionResult(task)*100/task.goal.count;
                } else {
                    return GetTaskCompletionResult(task)*100/task.goal.count;
                }
            }
            return 0;
        }

        function GetTaskGoalText(task) {
            if (task.goal != null) {
                if (task.goal.type === 'count') {
                    return (GetTaskCompletionResult(task) ?? 0) + '/' + task.goal.count;
                } else {
                    if (task.goal.count < 60) {
                        return (GetTaskCompletionResult(task) ?? 0) + '/' + task.goal.count + ' —Å–µ–∫—É–Ω–¥';
                    }
                    const result = GetTaskCompletionResult(task) ?? 0;
                    let text;
                    if (task.goal.count >= 60) {
                        if (result >= 300) {
                            text = Math.floor((result)/60);
                        } else {
                            text = Math.floor((result)/6)/10;
                        }
                        text += '/';
                        if (task.goal.count >= 300) {
                            text += Math.floor(task.goal.count/60);
                        } else {
                            text += Math.floor(task.goal.count/6)/10;
                        }
                        text += ' –º–∏–Ω—É—Ç';
                    } else {
                        text = result + '/' + task.goal.count + ' —Å–µ–∫—É–Ω–¥';
                    }
                    return text;
                }
            }
            return '';
        }

        function GetTaskCompletionResult(task) {
            if (task.regularity) {
                const year = selectedDate.getFullYear();
                const weekNumber = selectedDate.getWeekNumber();
                const dayOfWeek = selectedDate.getDay();

                if (task.completion != null &&
                    task.completion[year] &&
                    task.completion[year][weekNumber] &&
                    task.completion[year][weekNumber][dayOfWeek] != null) {
                    return task.completion[year][weekNumber][dayOfWeek];
                }
            } else {
                if (task.completion != null) {
                    return task.completion;
                }
            }

            return null;
        }

        function IsTaskCompleted(task) {
            const result = GetTaskCompletionResult(task);

            if (result !== null) {
                if (task.goal != null) {
                    return result >= task.goal.count;
                }
                return result === true;
            }

            return false;
        }

        function IsTaskExpired(task, date) {
            return task.dateEnd != null && (task.completedAt == null && date > (new Date(new Date(task.dateEnd).toDateString())) ||
                (task.completedAt != null && date > (new Date(new Date(task.completedAt).toDateString()))));
        }

        function SetTaskComplete(task, result) {
            const year = selectedDate.getFullYear();
            const weekNumber = selectedDate.getWeekNumber();
            const dayOfWeek = selectedDate.getDay();
            if (task.regularity) {
                if (!task.completion || typeof task.completion !== 'object') {
                    task.completion = {};
                }
                if (!task.completion[year]) {
                    task.completion[year] = {};
                }
                if (!task.completion[year][weekNumber]) {
                    task.completion[year][weekNumber] = {};
                }
                task.completion[year][weekNumber][dayOfWeek] = result;
            }
            else {
                task.completion = result;
                if (IsTaskCompleted(task)) {
                    const month = (selectedDate.getMonth() + 1).toString().padStart(2, '0');
                    const day = selectedDate.getDate().toString().padStart(2, '0');
                    task.completedAt = `${year}-${month}-${day}`;
                } else {
                    delete (task.completedAt);
                }
            }
        }

        // ================================ //
        // === –°—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–∞–π—Ç–∞ === //
        // ================================ //

        const noteModal = new bootstrap.Modal(document.getElementById('noteModal'));
        const formNoteModalEl = document.getElementById('formNoteModal');
        const formNoteModal = new bootstrap.Modal(formNoteModalEl);

        // –º–∞—Å—Å–∏–≤ ID –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
        const containers = ['notesContainer', 'routineContainer', 'tasksContainer', 'profileContainer'];
        const navTop = document.querySelector('.nav-top');

        const formIsTaskSwitch = document.getElementById('isTaskSwitch');
        const formFields = {
            id: document.getElementById('formNoteID'),
            icon: document.getElementById('formNoteIcon'),
            title: document.getElementById('formNoteTitle'),
            description: document.getElementById('formNoteDescription'),
            folder: document.getElementById('formNoteFolder'),
            parent: document.getElementById('formNoteParentNote'),
            dateStart: document.getElementById('taskDateStart'),
            dateStartContainer: document.getElementById('taskDateStartContainer'),
            dateEnd: document.getElementById('taskDateEnd'),
            dateEndContainer: document.getElementById('taskDateEndContainer'),
            repeat: document.getElementById('taskRepeat'),
            repeatContainer: document.getElementById('taskRepeatContainer'),
            repeatDailyContainer: document.getElementById('repeatDailyContainer'),
            dailyInterval: document.getElementById('dailyInterval'),
            repeatWeeklyContainer: document.getElementById('repeatWeeklyContainer'),
            weeklyInterval: document.getElementById('weeklyInterval'),
            repeatMonthlyContainer: document.getElementById('repeatMonthlyContainer'),
            monthlyInterval: document.getElementById('monthlyInterval'),
            timeType: document.getElementById('taskTimeType'),
            timeTypeContainer: document.getElementById('taskTimeContainer'),
            timePeriodContainer: document.getElementById('taskTimePeriodContainer'),
            timeStart: document.getElementById('taskTimeStart'),
            timeEnd: document.getElementById('taskTimeEnd'),
            goalType: document.getElementById('taskGoalType'),
            goalTypeContainer: document.getElementById('taskGoalContainer'),
            countGoal: document.getElementById('taskGoalCount'),
            timeGoal: document.getElementById('taskTimeGoal'),
            repeatCount: document.getElementById('taskRepeatCount'),
            goalMinutes: document.getElementById('taskGoalMinutes'),
            goalSeconds: document.getElementById('taskGoalSeconds')
        };
        const noteForm = document.getElementById('formNoteForm');

        // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É
        const deleteBtn = document.getElementById('deleteAllBtn');
        const resetToFactory = document.getElementById('resetToFactoryBtn');

        function refreshRoutine() {
            const container = document.getElementById('routineContainer');

            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
            container.innerHTML = '';

            // –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å–µ–≥–æ–¥–Ω—è
            const tasksToday = getRegularityTasksFromDate(selectedDate);

            // –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            tasksToday.forEach(task => {
                container.appendChild(renderTaskHtmlBlock(task));
            });
        }

        function refreshTasks() {
            const container = document.getElementById('tasksContainer');

            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
            container.innerHTML = '';

            // –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á–∏ –±–µ–∑ —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏
            const onetimeTasks = getOnetimeTasksFromDate(selectedDate);

            // –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            onetimeTasks.forEach(task => {
                container.appendChild(renderTaskHtmlBlock(task));
            });
        }

        function refreshNotes() {
            const contentContainer = document.getElementById('notesContainerContent');
            contentContainer.innerHTML = ''; // –æ—á–∏—â–∞–µ–º

            // –°–æ–∑–¥–∞–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç, —á—Ç–æ–±—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏ –ø–æ –ø–∞–ø–∫–∞–º
            const notesByFolder = {};
            const subNotes = {};

            // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–º–µ—Ç–∫–∏ –ø–æ –ø–∞–ø–∫–∞–º
            for (const noteId in data.notes) {
                const note = data.notes[noteId];
                const folderId = note.folder ?? null;
                if (!notesByFolder[folderId]) {
                    notesByFolder[folderId] = [];
                }
                if (note.parent != null && data.notes[note.parent].folder === note.folder) {
                    if (!subNotes[note.parent]) {
                        subNotes[note.parent] = [];
                    }
                    subNotes[note.parent].push(note);
                } else {
                    notesByFolder[folderId].push(note);
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–ª–æ–∫–∞ –ø–∞–ø–∫–∏
            function createFolderBlock(folderId, folderName, nestedFolders=[]) {
                const folderDiv = document.createElement('div');
                folderDiv.className = 'folder';

                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–ø–∫–∏
                const headerDiv = document.createElement('div');
                headerDiv.className = 'folder-header';

                const folderNameSpan = document.createElement('span');
                folderNameSpan.className = 'folder-name';
                folderNameSpan.textContent = folderName; // + '(' + folderId + ')';

                const plusIcon = document.createElement('i');
                plusIcon.className = 'bi bi-plus-square icon';
                plusIcon.title = 'Add a note';

                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏ –≤ —ç—Ç–æ—Ç –ø–∞–ø–∫—É
                plusIcon.addEventListener('click', () => {
                    ResetNoteForm();
                    formNoteModal.show();
                    formFields.folder.value = folderId;
                });

                headerDiv.appendChild(folderNameSpan);
                headerDiv.appendChild(plusIcon);
                folderDiv.appendChild(headerDiv);

                // –ó–∞–º–µ—Ç–∫–∏ –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏
                const notesListDiv = document.createElement('div');
                notesListDiv.className = 'notes-list';

                const notesInFolder = notesByFolder[folderId] || [];
                notesInFolder.forEach(note => {
                    notesListDiv.appendChild(RenderNoteElement(note, subNotes));
                });

                folderDiv.appendChild(notesListDiv);

                // –í–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏ (—Ä–µ–∫—É—Ä—Å–∏—è)
                if (nestedFolders.length > 0) {
                    nestedFolders.forEach(nestedFolder => {
                        const nestedFolderId = nestedFolder.id
                        const nestedFolderName = data.folders[nestedFolderId].name || 'Nested folder';
                        const nestedFoldersChildren = nestedFolder.children; // –º–∞—Å—Å–∏–≤ –∏–ª–∏ null
                        // –í—ã–∑–æ–≤ –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö
                        const nestedFolderDiv = createFolderBlock(nestedFolderId, nestedFolderName, nestedFoldersChildren ?? []);
                        folderDiv.appendChild(nestedFolderDiv);
                    });
                }

                return folderDiv;
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            for (const folderIndex in data.structure) {
                const folderId = data.structure[folderIndex].id;
                const nestedFolderIds = data.structure[folderIndex].children; // –º–∞—Å—Å–∏–≤ –∏–ª–∏ null
                const folderName = data.folders[folderId].name || 'Unnamed folder';

                const folderDiv = createFolderBlock(folderId, folderName, nestedFolderIds ?? []);
                contentContainer.appendChild(folderDiv);
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–º–µ—Ç–æ–∫ –±–µ–∑ –ø–∞–ø–∫–∏
            const notesWithoutFolder = notesByFolder[null] || [];
            if (notesWithoutFolder.length > 0) {
                const noFolderDiv = document.createElement('div');
                noFolderDiv.className = 'no-folder';

                const titleDiv = document.createElement('div');
                titleDiv.className = 'folder-header';
                const title = document.createElement('span');
                title.className = 'folder-name';
                title.textContent = 'Notes without a folder';

                const notesListDiv = document.createElement('div');
                notesListDiv.className = 'notes-list';

                notesWithoutFolder.forEach(note => {
                    notesListDiv.appendChild(RenderNoteElement(note));
                });

                titleDiv.appendChild(title);
                noFolderDiv.appendChild(title);
                noFolderDiv.appendChild(notesListDiv);
                contentContainer.appendChild(noFolderDiv);
            }
        }

        function RenderNoteDiv(note) {
            const noteDiv = document.createElement('div');
            noteDiv.className = 'note';

            const noteTitleDiv = document.createElement('div');
            noteTitleDiv.className = 'note-title';
            noteTitleDiv.textContent = note.title;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
            noteTitleDiv.addEventListener('click', () => {
                // –ó–¥–µ—Å—å –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
                document.getElementById('noteModalLabel').innerText = note.title;
                document.getElementById('noteDescription').innerText = note.description;
                noteModal.show();
            });

            const editIcon = document.createElement('i');
            editIcon.className = 'bi bi-pencil-square icon';
            editIcon.title = 'Edit';
            editIcon.addEventListener('click', () => {
                ShowNoteFormForNote(note.id);
            });

            const deleteIcon = document.createElement('i');
            deleteIcon.className = 'bi bi-trash icon';
            deleteIcon.title = 'Delete';

            noteDiv.appendChild(noteTitleDiv);
            noteDiv.appendChild(editIcon);
            noteDiv.appendChild(deleteIcon);

            return noteDiv;
        }

        function RenderNoteElement(note, subNotes = []) {
            const noteBlock = document.createElement('div');
            noteBlock.className = 'full-note';

            let noteDiv = RenderNoteDiv(note);
            noteBlock.appendChild(noteDiv);

            // –î–æ—á–µ—Ä–Ω–∏–µ –∑–∞–ø–∏—Å–∏
            const noteSubs = subNotes[note.id];
            if (noteSubs) {
                const noteSubNotes = document.createElement('div');
                noteSubNotes.className = 'sub-notes';

                // –°–æ–∑–¥–∞—ë–º –¥–æ—á–µ—Ä–Ω–∏–µ –∑–∞–ø–∏—Å–∏
                noteSubs.forEach(subNote => {
                    noteDiv = RenderNoteElement(subNote, subNotes);
                    noteSubNotes.appendChild(noteDiv);
                });

                noteBlock.appendChild(noteSubNotes);
            }

            return noteBlock;
        }

        function ResetNoteForm()
        {
            noteForm.reset();
        }

        function showNotification(message) {
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('notificationModalBody').textContent = message;

            // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const notifModal = new bootstrap.Modal(document.getElementById('notificationModal'));
            notifModal.show();
        }

        function ShowNoteFormForNote(note_id) {
            const note = data.notes[note_id];

            ResetNoteForm();
            formFields.id.value = note.id;
            formFields.icon.value = note.icon ?? '';
            formFields.title.value = note.title;
            formFields.description.value = note.description;
            formFields.folder.value = note.folder ?? '';
            formFields.parent.value = note.parent ?? '';
            if (note.task != null) {
                const task = data.tasks[note.task];
                formIsTaskSwitch.checked = true;
                formFields.dateStart.value = task.dateStart ?? '';
                formFields.dateEnd.value = task.dateEnd ?? '';

                const regType = task.regularity ? task.regularity.type : 'null';
                formFields.repeat.value = regType;
                switch (regType) {
                    case 'daily':
                        formFields.dailyInterval.value = task.regularity.interval;
                        break;
                    case 'weekly':
                        formFields.weeklyInterval.value = task.regularity.interval;
                        const daysOfWeek = task.regularity.daysOfWeek;
                        document.querySelectorAll('.weekly-day-checkbox').forEach(checkbox => {
                            checkbox.checked = false;
                        });
                        daysOfWeek.forEach(day => {
                            const checkbox = document.querySelector(`.weekly-day-checkbox[value="${day}"]`);
                            if (checkbox) {
                                checkbox.checked = true;
                            }
                        });
                        break;
                    case 'monthly':
                        formFields.monthlyInterval.value = task.regularity.interval;
                        const daysOfMonth = task.regularity.daysOfMonth;
                        const monthDaysSelect = document.getElementById('monthDays');
                        Array.from(monthDaysSelect.options).forEach(option => {
                            option.selected = false;
                        });
                        daysOfMonth.forEach(day => {
                            const option = Array.from(monthDaysSelect.options).find(opt => parseInt(opt.value) === day);
                            if (option) {
                                option.selected = true;
                            }
                        });
                        break;
                }

                if (task.timeStart != null) {
                    formFields.timeStart.value = task.timeStart;
                    if (task.timeEnd != null) {
                        formFields.timeType.value = 'period';
                        formFields.timeEnd.value = task.timeEnd;
                    } else {
                        formFields.timeType.value = 'exact';
                    }
                } else {
                    formFields.timeType.value = 'null';
                }

                const goalType = task.goal ? task.goal.type : 'null';
                formFields.goalType.value = goalType;
                switch (goalType) {
                    case 'count':
                        formFields.repeatCount.value = task.goal.count;
                        break;
                    case 'time':
                        const time = task.goal.count;
                        formFields.goalMinutes.value = Math.floor(time/60);
                        formFields.goalSeconds.value = time - Math.floor(time/60)*60;
                        break;
                    case 'null':
                        break;
                }
            }
            formNoteModal.show();
        }

        function renderTaskHtmlBlock(task) {
            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏–∑ note
            const noteId = task.note;
            const note = Object.values(data.notes).find(n => n.id === noteId);
            const taskTitle = note ? note.title : 'Untitled';
            const done = IsTaskCompleted(task);

            // –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –∑–∞–¥–∞—á–∏
            const taskDiv = document.createElement('div');
            let taskDivClassName = done ? 'task done' : 'task';
            if (!task.regularity) taskDivClassName += IsTaskExpired(task, selectedDate) ? ' expired' : '';
            taskDiv.className = taskDivClassName;
            if (!done) {
                const percent = GetTaskGoalPercent(task);
                if (percent !== 0) {
                    // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª—å
                    taskDiv.style.background = `linear-gradient(to right, #c1faeb ${percent}%, #f8fcff ${percent}%)`;
                }
            }

            // –õ–µ–≤–∞—è –∏–∫–æ–Ω–∫–∞
            const leftDiv = document.createElement('div');
            leftDiv.className = 'task-left';

            // <i>
            /*const leftIcon = document.createElement('i');
            leftIcon.className = 'bi bi-check-circle icon'; // –ò–∫–æ–Ω–∫–∞ —Å–ª–µ–≤–∞
            leftDiv.appendChild(leftIcon);*/
            const leftIcon = document.createElement('span');
            leftIcon.textContent = note && note.icon ? note.icon : '‚úçÔ∏è'; // –ò–∫–æ–Ω–∫–∞ —Å–ª–µ–≤–∞
            leftDiv.appendChild(leftIcon);

            // –¶–µ–Ω—Ç—Ä —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º
            const centerDiv = document.createElement('div');
            centerDiv.className = 'task-center';

            const timeDiv = document.createElement('div');
            timeDiv.className = 'task-time';
            let timeText = task.timeStart ? task.timeStart + (task.timeEnd ? ' - ' + task.timeEnd : '') : '';
            if (task.dateEnd && !task.regularity) {
                const dateEnd = new Date(task.dateEnd);
                let dateText = dateEnd.toLocaleDateString('en', { year: 'numeric', month: 'long', day: 'numeric' });
                dateText = dateText.replace(/\s/g, '\u00A0'); // –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã –Ω–∞ –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–µ
                if (task.dateStart !== task.dateEnd) {
                    if (timeText !== '') {
                        timeText = timeText + ' until ' + dateText;
                    } else {
                        timeText = 'until ' + dateText;
                        timeText = timeText.charAt(0).toUpperCase() + timeText.slice(1);
                    }
                } else {
                    if (timeText !== '') {
                        timeText = timeText + ' - ' + dateText;
                    } else {
                        timeText = dateText;
                        timeText = timeText.charAt(0).toUpperCase() + timeText.slice(1);
                    }
                }
            }
            const goalText = GetTaskGoalText(task);
            if (timeText !== '') {
                if (goalText !== '') {
                    timeText = timeText + ' (' + goalText + ')';
                }
            } else {
                timeText = goalText;
            }
            timeDiv.textContent = timeText;

            const titleDiv = document.createElement('div');
            titleDiv.className = 'task-title';
            titleDiv.textContent = taskTitle;

            centerDiv.appendChild(titleDiv);
            centerDiv.appendChild(timeDiv);

            // –ü—Ä–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞
            const rightDiv = document.createElement('div');
            rightDiv.className = 'task-right';

            const rightIcon = document.createElement('i');
            rightIcon.className = done ? 'bi-check-circle' : 'bi bi-circle';
            rightIcon.setAttribute('title', 'Finish');

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∏–∫–æ–Ω–∫–µ
            rightIcon.addEventListener('click', () => {
                clickOnTaskCompleteButton(task);
            });
            rightDiv.appendChild(rightIcon);

            // –°–æ–±–∏—Ä–∞–µ–º –≤–µ—Å—å –±–ª–æ–∫
            taskDiv.appendChild(leftDiv);
            taskDiv.appendChild(centerDiv);
            taskDiv.appendChild(rightDiv);

            return taskDiv;
        }

        function clickOnTaskCompleteButton(task) {
            if (task.goal) {
                if (task.goal.type === 'count') {
                    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—è task
                    document.getElementById('task').value = task.id; // –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —É –∑–∞–¥–∞—á–∏ –µ—Å—Ç—å –ø–æ–ª–µ id

                    // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞
                    document.getElementById('goalNumberInput').value = GetTaskCompletionResult(task);

                    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    var modal = new bootstrap.Modal(document.getElementById('goalInputModal'));
                    modal.show();

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ OK
                    const confirmBtn = document.getElementById('modalConfirmBtn');

                    // –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª—É—à–∞—Ç–µ–ª–µ–π ‚Äî —É–¥–∞–ª–∏–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π
                    confirmBtn.replaceWith(confirmBtn.cloneNode(true));
                    document.getElementById('modalConfirmBtn').addEventListener('click', () => {
                        const value = document.getElementById('goalNumberInput').value;
                        if (value !== '' && !isNaN(value)) {
                            const taskId = document.getElementById('task').value;

                            // –ù–∞–π—Ç–∏ –∑–∞–¥–∞—á—É –ø–æ ID
                            const taskToUpdate = data.tasks[taskId]; // –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –µ—Å—Ç—å —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è

                            if (taskToUpdate) {
                                SetTaskComplete(taskToUpdate, Number(value));

                                // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                                bootstrap.Modal.getInstance(document.getElementById('goalInputModal')).hide();

                                save();
                                if (taskToUpdate.regularity) {
                                    refreshRoutine();
                                } else {
                                    refreshTasks();
                                }
                            }
                        } else {
                            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                        }
                    });
                } else {
                    alert('Other target or unidentified type.');
                    return;
                }
            } else {
                const done = !IsTaskCompleted(task);
                SetTaskComplete(task, done);
                save();
                if (task.regularity) {
                    refreshRoutine();
                } else {
                    refreshTasks();
                }
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.querySelectorAll('.nav-button').forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.getAttribute('data-target'); // –Ω–∞–ø—Ä–∏–º–µ—Ä, 'notesContainer'

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞
                if (btn.classList.contains('active')) {
                    // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
                    return;
                }

                if (targetId === 'tasksContainer' || targetId === 'routineContainer') {
                    // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                    navTop.classList.remove('disabled');
                } else {
                    // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫
                    navTop.classList.add('disabled');
                }

                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π
                btn.classList.add('active');

                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
                containers.forEach(id => {
                    const container = document.getElementById(id);
                    container.classList.remove('show');
                });

                const targetContainer = document.getElementById(targetId);
                if (targetContainer) {
                    targetContainer.classList.add('show');
                }

                localStorage.setItem('activeTab', targetId);
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            const savedTargetId = localStorage.getItem('activeTab');

            if (savedTargetId) {
                const btn = document.querySelector(`.nav-button[data-target="${savedTargetId}"]`);
                if (btn && !btn.classList.contains('active')) {
                    btn.click();  // –ò–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –∫–æ–¥, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∫–ª–∞–¥–∫—É
                }
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –¥–∞—Ç—ã
        function updateFullDateDisplay() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const text = selectedDate.toLocaleDateString('en', options);
            document.getElementById('fullDateDisplay').textContent = text.charAt(0).toUpperCase() + text.slice(1);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –¥–Ω–µ–π
        function updateWeek(weekDate) {
            selectedDate = weekDate;
            // –≤—ã—á–∏—Å–ª—è–µ–º –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏
            currentWeekStart = weekDate.getWeekStart();
            const days = document.querySelectorAll('.day');
            days.forEach((dayElem, index) => {
                const date = new Date(currentWeekStart);
                date.setDate(currentWeekStart.getDate() + index);
                // –æ–±–Ω–æ–≤–ª—è–µ–º data-day
                dayElem.setAttribute('data-day', date.toStringWithoutTime());
                // –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–Ω–µ–π –∏ –Ω–∞–∑–≤–∞–Ω–∏–π
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayElem.innerHTML = `<div>${dayNames[date.getDay()]}</div><div>${date.getDate()}</div>`;
                // –µ—Å–ª–∏ —ç—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å, –¥–µ–ª–∞–µ–º –µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã–º
                if (date.toDateString() === selectedDate.toDateString()) {
                    dayElem.classList.add('active');
                }
                else {
                    dayElem.classList.remove('active');
                }
            });
            updateFullDateDisplay();
            refreshRoutine();
            refreshTasks();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –¥–Ω—é
        document.querySelectorAll('.day').forEach(day => {
            day.addEventListener('click', () => {
                if (day.classList.contains('active')) {
                    return;
                }

                document.querySelectorAll('.day').forEach(d => d.classList.remove('active'));
                day.classList.add('active');
                const dateStr = day.getAttribute('data-day');
                selectedDate = new Date((new Date(dateStr)).toDateString());
                updateFullDateDisplay();

                taskContainerAnimatedUpdate();

                refreshRoutine();
                refreshTasks();
            });
        });

        function taskContainerAnimatedUpdate() {
            containers.forEach(id => {
                const container = document.getElementById(id);

                if (container.classList.contains('show') && (id === 'tasksContainer' || id === 'routineContainer')) {
                    const transitionDuration = 135;
                    container.classList.remove('show');

                    // –ñ–¥–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å –æ–±—Ä–∞—Ç–Ω–æ
                    setTimeout(() => {
                        container.classList.add('show');
                    }, transitionDuration);
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–¥–µ–ª–∏
        document.getElementById('prevWeek').addEventListener('click', () => {
            currentWeekStart.setDate(currentWeekStart.getDate() - 1);
            updateWeek(currentWeekStart);
            taskContainerAnimatedUpdate();
        });
        document.getElementById('nextWeek').addEventListener('click', () => {
            currentWeekStart.setDate(currentWeekStart.getDate() + 7);
            updateWeek(currentWeekStart);
            taskContainerAnimatedUpdate();
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å" –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏
        document.getElementById('formNoteSaveBtn').addEventListener('click', () => {
            let id = parseInt(formFields.id.value.trim());
            if (isNaN(id)) id = null;

            const icon = formFields.icon.value.trim();
            const title = formFields.title.value.trim();
            const description = formFields.description.value.trim();
            const selectedFolderId = formFields.folder.value;
            const folderId = selectedFolderId ? parseInt(selectedFolderId) : null;
            const selectedParentId = formFields.parent.value;
            const parentId = selectedParentId ? parseInt(selectedParentId) : null;
            const isTask = formIsTaskSwitch.checked ?? false;
            let taskDeleted = false;

            let note, task;
            if (id != null) // –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é –∑–∞–ø–∏—Å—å (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)
            {
                note = data.notes[id]; // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç

                note.icon = icon;
                note.title = title;
                note.description = description;
                note.folder = folderId;
                note.parent = parentId;
            }
            else {
                if (!title) {
                    alert('Please fill in all fields.');
                    return;
                }

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ID –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
                data.note_max_id++;
                const note_id = data.note_max_id;

                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É
                note = {
                    id: note_id,
                    title: title,
                    description: description,
                    folder: folderId,
                    parent: parentId,
                };

                data.notes[note_id] = note;
                updateParentNoteOptions();
            }

            if (isTask) {
                if (id != null && note.task) {
                    task = data.tasks[note.task];
                }
                if (task == null) {
                    data.task_max_id++;
                    const task_id = data.task_max_id;

                    task = {
                        id: task_id,
                        note: note.id,
                        dateStart: formFields.dateStart.value,
                    };
                    data.tasks[task_id] = task;

                    note.task = task_id;
                }
            } else {
                if (id != null && note.task) {
                    delete data.tasks[note.task];
                    delete note.task;
                    taskDeleted = true;
                }
            }


            if (isTask) {
                const goalType = formFields.goalType.value;
                const timeStart = formFields.timeType.value !== 'null' ? formFields.timeStart.value : null;
                const dateEnd = formFields.dateEnd.value;
                const repeatable = formFields.repeat.value !== 'null' ? formFields.repeat.value : null;

                if (dateEnd != null && dateEnd !== '') {
                    task.dateEnd = dateEnd;
                } else {
                    if ('dateEnd' in task) {
                        delete task.dateEnd;
                    }
                }

                if (goalType !== 'null') {
                    task.goal = {};
                    task.goal.type = goalType;
                    task.goal.count = goalType === 'count' ?
                        (formFields.repeatCount.value * 1 ?? 1) :
                        (formFields.goalMinutes.value * 60 ?? 0) + (formFields.goalSeconds.value * 1 ?? 0);
                } else {
                    if ('goal' in task) {
                        delete task.goal;
                    }
                }

                if (timeStart != null && timeStart !== '') {
                    task.timeStart = timeStart;
                    const timeEnd = formFields.timeType.value === 'period' ? formFields.timeEnd.value : null;
                    if (timeEnd != null) {
                        task.timeEnd = timeEnd;
                    } else {
                        if ('timeEnd' in task) {
                            delete task.timeEnd;
                        }
                    }
                } else {
                    if ('timeStart' in task) {
                        delete task.timeStart;
                    }
                    if ('timeEnd' in task) {
                        delete task.timeEnd;
                    }
                }

                if (repeatable != null && repeatable !== '') {
                    switch (repeatable) {
                        case 'daily':
                            let dailyInterval = formFields.dailyInterval.value ?? 1;
                            if (dailyInterval === '') dailyInterval = 1;
                            task.regularity = {
                                type: 'daily',
                                interval: (dailyInterval * 1),
                            };
                            break;
                        case 'weekly':
                            let weeklyInterval = formFields.weeklyInterval.value ?? 1;
                            // –ü–æ–ª—É—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏
                            const selectedDays = Array.from(document.querySelectorAll('.weekly-day-checkbox:checked'))
                                .map(cb => parseInt(cb.value));
                            if (weeklyInterval === '') weeklyInterval = 1;
                            task.regularity = {
                                type: 'weekly',
                                daysOfWeek: selectedDays,
                                interval: (weeklyInterval * 1),
                            };
                            break;
                        case 'monthly':
                            let monthlyInterval = formFields.monthlyInterval.value ?? 1;
                            // –ü–æ–ª—É—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–Ω–∏ –º–µ—Å—è—Ü–∞
                            const selectedMonthDays = Array.from(document.getElementById('monthDays').selectedOptions)
                                .map(opt => parseInt(opt.value));
                            if (monthlyInterval === '') monthlyInterval = 1;
                            task.regularity = {
                                type: 'monthly',
                                daysOfMonth: selectedMonthDays,
                                interval: (monthlyInterval * 1),
                            };
                            break;
                    }
                } else {
                    if ('regularity' in task) {
                        delete task.regularity;
                    }
                }
            }

            if (icon !== '' && icon != null) {
                note.icon = icon;
            } else {
                if ('icon' in note) {
                    delete note.icon;
                }
            }

            save();

            if (isTask || taskDeleted) {
                refreshRoutine();
                refreshTasks();
            }
            refreshNotes();

            // –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Bootstrap
            formNoteModal.hide();
            ResetNoteForm(); // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        });

        function updateFolderListInForm() {
            // –û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏, –∫—Ä–æ–º–µ "–ë–µ–∑ –ø–∞–ø–∫–∏"
            formFields.folder.innerHTML = '<option value="">Without a folder</option>';
            // –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–∏ –∏–∑ data.folders
            for (const folderId in data.folders) {
                const folder = data.folders[folderId];
                const option = document.createElement('option');
                option.value = folder.id; // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å id –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ
                option.textContent = folder.name;
                formFields.folder.appendChild(option);
            }
        }

        formNoteModalEl.addEventListener('show.bs.modal', () => {
            toggleTaskFields(formIsTaskSwitch.checked);
        });

        formNoteModalEl.addEventListener('hide.bs.modal', () => {
            if (formFields.id.value > 0) {
                ResetNoteForm();
            }
        });

        function toggleTaskFields(show) {
            const displayStyle = show ? 'block' : 'none';

            // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å/—Å–∫—Ä—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
            formFields.dateStartContainer.style.display = show ? 'block' : 'none';
            formFields.dateEndContainer.style.display = show ? 'block' : 'none';
            formFields.repeatContainer.style.display = show ? 'block' : 'none';
            formFields.timeTypeContainer.style.display = show ? 'block' : 'none';
            formFields.goalTypeContainer.style.display = show ? 'block' : 'none';

            if (show) {
                showTimeType(formFields.timeType.value);
                showGoalType(formFields.goalType.value);
                if (!formFields.dateStart.value) formFields.dateStart.value = selectedDate.toStringWithoutTime();
                handleRepeatChange();
            }
        }

        function showTimeType(type) {
            if (type === 'exact') {
                formFields.timeStart.style.display = 'block';
                formFields.timeEnd.style.display = 'none';
                formFields.timeStart.disabled = false;
                formFields.timeEnd.disabled = true;
            } else if (type === 'period') {
                formFields.timeStart.style.display = 'block';
                formFields.timeEnd.style.display = 'block';
                formFields.timeStart.disabled = false;
                formFields.timeEnd.disabled = false;
            } else {
                formFields.timeStart.style.display = 'none';
                formFields.timeEnd.style.display = 'none';
                formFields.timeStart.disabled = true;
                formFields.timeEnd.disabled = true;
            }
        }

        function showGoalType(type) {
            if (type === 'count') {
                formFields.countGoal.style.display = 'block';
                formFields.timeGoal.style.display = 'none';

                formFields.repeatCount.disabled = false;
                formFields.goalMinutes.disabled = true;
                formFields.goalSeconds.disabled = true;
            } else if (type === 'time') {
                formFields.countGoal.style.display = 'none';
                formFields.timeGoal.style.display = 'block';

                formFields.repeatCount.disabled = true;
                formFields.goalMinutes.disabled = false;
                formFields.goalSeconds.disabled = false;
            } else {
                formFields.countGoal.style.display = 'none';
                formFields.timeGoal.style.display = 'none';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è
        formIsTaskSwitch.addEventListener('change', () => {
            toggleTaskFields(formIsTaskSwitch.checked);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–±–æ—Ä–æ–≤
        document.getElementById('taskTimeType').addEventListener('change', (e) => {
            showTimeType(e.target.value);
        });

        document.getElementById('taskGoalType').addEventListener('change', (e) => {
            showGoalType(e.target.value);
        });

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ select –¥–ª—è —á–∏—Å–µ–ª –º–µ—Å—è—Ü–∞
        const monthDaysSelect = document.getElementById('monthDays');
        for (let i = 1; i <= 31; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            monthDaysSelect.appendChild(option);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞
        function handleRepeatChange() {
            const value = formFields.repeat.value;
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            formFields.repeatDailyContainer.style.display = 'none';
            formFields.repeatWeeklyContainer.style.display = 'none';
            formFields.repeatMonthlyContainer.style.display = 'none';

            // –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±–æ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π –±–ª–æ–∫
            if (value === 'daily') {
                formFields.repeatDailyContainer.style.display = 'block';
            } else if (value === 'weekly') {
                formFields.repeatWeeklyContainer.style.display = 'block';
            } else if (value === 'monthly') {
                formFields.repeatMonthlyContainer.style.display = 'block';
            }
        }
        formFields.repeat.addEventListener('change', handleRepeatChange);

        function updateCreateFolderOptions() {
            const folderSelect = document.getElementById('parentFolderSelect');
            folderSelect.innerHTML = '<option value="">Without a folder</option>';

            for (const folderId in data.folders) {
                const folder = data.folders[folderId];
                const option = document.createElement('option');
                option.value = folder.id;
                option.textContent = folder.name;
                folderSelect.appendChild(option);
            }
        }

        function updateParentNoteOptions() {
            const noteSelect = document.getElementById('formNoteParentNote');
            noteSelect.innerHTML = '<option value="">Without a note</option>';

            for (const noteId in data.notes) {
                const note = data.notes[noteId];
                const option = document.createElement('option');
                option.value = note.id;
                option.textContent = note.title;
                noteSelect.appendChild(option);
            }
        }

        document.getElementById('createFolderForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const folderName = document.getElementById('folderName').value.trim();
            let parentFolderId = parseInt(document.getElementById('parentFolderSelect').value) ?? null;
            if (isNaN(parentFolderId)) parentFolderId = null;

            if (!folderName) return;

            data.folder_max_id++;
            let folder_id = data.folder_max_id;

            data.folders[folder_id] = {
                id: folder_id,
                name: folderName,
            };

            function addFolderToStructure(structure, parentFolderId, newFolder) {
                for (let item of structure) {
                    if (item.id === parentFolderId) {
                        // –ù–∞—à–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –ø–∞–ø–∫—É
                        item.children.push(newFolder);
                        return true; // —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–∏—Å–∫
                    }
                    if (item.children && Object.keys(item.children).length > 0) {
                        // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–∞–ø–æ–∫
                        const added = addFolderToStructure(item.children, parentFolderId, newFolder);
                        if (added) return true; // –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–ª–∏, –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –ø–æ–∏—Å–∫
                    }
                }
                return false; // –Ω–µ –Ω–∞—à–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—è
            }

            const newFolder = {
                id: folder_id,
                children: []
            };

            if (parentFolderId == null) {
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ—Ä–µ–Ω—å
                data.structure.push(newFolder);
            } else {
                // –ò—â–µ–º —Ä–æ–¥–∏—Ç–µ–ª—è –∏ –¥–æ–±–∞–≤–ª—è–µ–º
                const success = addFolderToStructure(data.structure, parentFolderId, newFolder);
                if (!success) {
                    console.error('–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –ø–∞–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    data.structure.push(newFolder);
                }
            }

            save();

            refreshNotes();
            updateFolderListInForm();
            updateCreateFolderOptions();

            // —Å–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
            document.getElementById('createFolderForm').reset();

            // –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modalInstance = bootstrap.Modal.getInstance(document.getElementById('formCreateFolder'));
            modalInstance.hide();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "Delete" –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        const deleteConfirmModalInstance = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
        document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
            // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            clearData();

            // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            deleteConfirmModalInstance.hide();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "Delete" –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        const resetToFactoryBtnConfirmModalInstance = new bootstrap.Modal(document.getElementById('resetToFactoryBtnConfirmModal'));
        document.getElementById('confirmResetBtn').addEventListener('click', () => {
            // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            resetData();
            window.location.reload();
        });

        document.getElementById('languageSelect').addEventListener('change', function() {
            setLocale(this.value);
            reloadLocale(this.value);
        });

        function checkLocale() {
            const locale = localStorage.getItem('appLocale');
            if (locale) {
                if (locale !== `en`) {
                    reloadLocale(locale);
                }
            } else {
                setLocale(`en`);
            }
        }
        function setLocale(locale) {
            localStorage.setItem('appLocale', locale);
        }
        function reloadLocale(locale) {
            switch (locale) {
                case 'en':
                    window.location.href = `https://theitdaily.github.io/task-aura`;
                    break;
                case 'ru':
                    window.location.href = `https://theitdaily.github.io/task-aura/ru`;
                    break;
            }
        }

        checkLocale();


        // ===================== //
        // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è === //
        // ===================== //

        load();
        updateWeek(selectedDate);
        refreshNotes();
        updateFolderListInForm();
        updateCreateFolderOptions();
        updateParentNoteOptions();
    </script>


</body></html>